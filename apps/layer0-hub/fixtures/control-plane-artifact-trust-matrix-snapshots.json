[
  {
    "name": "trust-valid-signature-manifest",
    "input": {
      "manifestRaw": "{\n  \"schema\": \"antiphon.artifact-manifest\",\n  \"version\": 1,\n  \"appId\": \"antiphon.layer.alpha\",\n  \"appVersion\": \"2.0.0\",\n  \"channel\": \"stable\",\n  \"digestAlgorithm\": \"sha256\",\n  \"files\": [\n    {\n      \"path\": \"README.txt\",\n      \"size\": 5,\n      \"sha256\": \"a82fb4a1a82fb4a1a82fb4a1a82fb4a1a82fb4a1a82fb4a1a82fb4a1a82fb4a1\"\n    }\n  ],\n  \"signature\": {\n    \"keyId\": \"layer-alpha-k1\",\n    \"algorithm\": \"ed25519\",\n    \"signature\": \"c2b2c261\"\n  }\n}",
      "expectedAppId": "antiphon.layer.alpha",
      "expectedVersion": "2.0.0",
      "nowIso": "2026-02-13T00:00:00.000Z",
      "requireSignature": true
    },
    "expected": {
      "trusted": true,
      "reasonCode": "ok_artifact_trust_verified",
      "remediation": "none"
    }
  },
  {
    "name": "trust-invalid-signature",
    "input": {
      "manifestRaw": "{\n  \"schema\": \"antiphon.artifact-manifest\",\n  \"version\": 1,\n  \"appId\": \"antiphon.layer.alpha\",\n  \"appVersion\": \"2.0.0\",\n  \"channel\": \"stable\",\n  \"digestAlgorithm\": \"sha256\",\n  \"files\": [\n    {\n      \"path\": \"README.txt\",\n      \"size\": 5,\n      \"sha256\": \"a82fb4a1a82fb4a1a82fb4a1a82fb4a1a82fb4a1a82fb4a1a82fb4a1a82fb4a1\"\n    }\n  ],\n  \"signature\": {\n    \"keyId\": \"layer-alpha-k1\",\n    \"algorithm\": \"ed25519\",\n    \"signature\": \"deadbeef\"\n  }\n}",
      "expectedAppId": "antiphon.layer.alpha",
      "expectedVersion": "2.0.0",
      "nowIso": "2026-02-13T00:00:00.000Z",
      "requireSignature": true
    },
    "expected": {
      "trusted": false,
      "reasonCode": "artifact_signature_invalid",
      "remediation": "reissue_artifact_signature"
    }
  },
  {
    "name": "trust-missing-signature-required",
    "input": {
      "manifestRaw": "{\n  \"schema\": \"antiphon.artifact-manifest\",\n  \"version\": 1,\n  \"appId\": \"antiphon.layer.alpha\",\n  \"appVersion\": \"2.0.0\",\n  \"channel\": \"stable\",\n  \"digestAlgorithm\": \"sha256\",\n  \"files\": [\n    {\n      \"path\": \"README.txt\",\n      \"size\": 5,\n      \"sha256\": \"a82fb4a1a82fb4a1a82fb4a1a82fb4a1a82fb4a1a82fb4a1a82fb4a1a82fb4a1\"\n    }\n  ]\n}",
      "expectedAppId": "antiphon.layer.alpha",
      "expectedVersion": "2.0.0",
      "nowIso": "2026-02-13T00:00:00.000Z",
      "requireSignature": true
    },
    "expected": {
      "trusted": false,
      "reasonCode": "artifact_signature_missing",
      "remediation": "reissue_artifact_signature"
    }
  },
  {
    "name": "trust-corrupted-manifest-json",
    "input": {
      "manifestRaw": "{\"schema\":\"antiphon.artifact-manifest\"",
      "expectedAppId": "antiphon.layer.alpha",
      "expectedVersion": "2.0.0",
      "nowIso": "2026-02-13T00:00:00.000Z",
      "requireSignature": true
    },
    "expected": {
      "trusted": false,
      "reasonCode": "invalid_artifact_manifest_json",
      "remediation": "rebuild_artifact_manifest"
    }
  },
  {
    "name": "trust-app-version-mismatch",
    "input": {
      "manifestRaw": "{\n  \"schema\": \"antiphon.artifact-manifest\",\n  \"version\": 1,\n  \"appId\": \"antiphon.layer.beta\",\n  \"appVersion\": \"3.0.0\",\n  \"channel\": \"stable\",\n  \"digestAlgorithm\": \"sha256\",\n  \"files\": [\n    {\n      \"path\": \"README.txt\",\n      \"size\": 5,\n      \"sha256\": \"a82fb4a1a82fb4a1a82fb4a1a82fb4a1a82fb4a1a82fb4a1a82fb4a1a82fb4a1\"\n    }\n  ]\n}",
      "expectedAppId": "antiphon.layer.alpha",
      "expectedVersion": "2.0.0",
      "nowIso": "2026-02-13T00:00:00.000Z",
      "requireSignature": false
    },
    "expected": {
      "trusted": false,
      "reasonCode": "artifact_app_version_mismatch",
      "remediation": "retry_install"
    }
  },
  {
    "name": "trust-signature-clock-skew",
    "input": {
      "manifestRaw": "{\n  \"schema\": \"antiphon.artifact-manifest\",\n  \"version\": 1,\n  \"appId\": \"antiphon.layer.alpha\",\n  \"appVersion\": \"2.0.0\",\n  \"channel\": \"stable\",\n  \"digestAlgorithm\": \"sha256\",\n  \"files\": [\n    {\n      \"path\": \"README.txt\",\n      \"size\": 5,\n      \"sha256\": \"a82fb4a1a82fb4a1a82fb4a1a82fb4a1a82fb4a1a82fb4a1a82fb4a1a82fb4a1\"\n    }\n  ],\n  \"signature\": {\n    \"keyId\": \"layer-alpha-k1\",\n    \"algorithm\": \"nbf:2026-02-13T01:00:00.000Z;naf:2026-02-14T00:00:00.000Z\",\n    \"signature\": \"c2b2c261\"\n  }\n}",
      "expectedAppId": "antiphon.layer.alpha",
      "expectedVersion": "2.0.0",
      "nowIso": "2026-02-13T00:00:00.000Z",
      "requireSignature": true,
      "maxClockSkewSeconds": 30
    },
    "expected": {
      "trusted": false,
      "reasonCode": "artifact_signature_clock_skew",
      "remediation": "refresh_online_session"
    }
  }
]
